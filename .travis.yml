language: go

go:
- 1.7

env:
- GO_VENDOR=1

before_install:
- nvm --version
- nvm install 7.2.0
- node --version && npm --version
- npm install -g codecov
- go version

install:
- go get -u -v github.com/alecthomas/gometalinter
- go get -u -v github.com/kardianos/govendor
- gometalinter --install --update --force
- govendor sync -v
- npm install

script:
- npm run lint:client
- npm run lint:server
- npm run test:client
- npm run test:server
- npm run test:coverage && codecov

before_deploy:
- git config --global user.email "github@travis-ci.org"
- git config --global user.name "Travis CI"
- git reset --hard
- npm version ${TRAVIS_TAG}
- npm run dist

deploy:
  provider: releases
  api_key:
    secure: f8LLhkmihUSbbYndqdD9y+h1MzIu0Hm54BBF9Z08rEfKtT3UqiaPKmAdFW8Qth2RnjG9Ds+JZ6L6Zr9FaMprAZWfaO0UrHF9lUleVflsPESlhIFQ4tynnW/WRWhN/+4txdKn5KhXn/Pgu5uu772XtWtZTaBDbGblTY8d7bSrPYdOPO1+ZhJJZxk4A3rylGPC9e+CD+rJIyhlPic0Pj9OGjS6Z0xiZXI4Q/jfH0cIRFm1UcWFJFjRl6suVtRPSdW5lVvLtfkfF2UuKqPzhAwlcOmCqS97z+/LOsCV/Ic9hC6L42aGkyjTnlQXCOktnk3eEGFgqjaDNTE2sHnvyZsL0h1hVw31HM3cZsdTQvUSyMU0HfITwbfXpILFssuGblMwEYCjjvUDi9IZt+wHVmX8qmn0XLOwfqyLlpPswjYHFGjI+IDNDujdiuS2pNaBYRQ83U1SJ+a6mc4EvgQra3r5Ht8rIj27Pzwv9j7AsZe7OiFtmElHNrWgJ9rNGn6luwZz423b0bSYprYS56AWknq/ESkh8TKBYh45yEOCK7uexAoD9UvvqgOaozOLQO+VQaKDRdnvxpenG7hFgItDGNl6fiUEm2/WBCyuPDDwLNMfyK0iDrRhCrplfrcUQnwz8YwRh58UznsoDtMaFscxiEUtp/ELob10wXW7Euh6Cpg34bs=
  file: dist/dad-${TRAVIS_TAG}.zip
  skip_cleanup: true
  on:
    tags: true

after_deploy:
- "curl -H 'Content-Type: application/json' --data \"{\\\"source_type\\\": \\\"Tag\\\", \\\"source_name\\\": \\\"${TRAVIS_TAG}\\\"}\" -X POST https://registry.hub.docker.com/u/soprasteria/dad/trigger/${DOCKER_HUB_TOKEN}/"
